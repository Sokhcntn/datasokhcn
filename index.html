<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IOC Task Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
body{font-family:Inter, sans-serif;overflow:hidden}
.dashboard{height:28vh}
.sidebar{width:16vw}
.submenu{height:8vh}
.content{height:64vh}
.status{font-size:10px;font-weight:800;padding:2px 8px;border-radius:4px}
</style>
</head>

<body class="bg-slate-50 flex">

<!-- SIDEBAR -->
<aside class="sidebar h-screen bg-slate-900 text-white flex flex-col">
<div class="p-5 border-b border-slate-800 text-center font-black text-blue-400">
QUẢN LÝ NHIỆM VỤ
</div>

<ul id="menu" class="flex-1 p-3 space-y-1"></ul>

<label class="p-4 bg-slate-950 cursor-pointer text-center text-xs font-bold">
UPLOAD EXCEL
<input type="file" id="file" hidden>
</label>
</aside>

<!-- RIGHT -->
<div class="flex-1 flex flex-col">

<!-- DASHBOARD -->
<header class="dashboard flex flex-col">

<div class="flex-1 bg-slate-800 text-white flex items-center px-8 gap-8">

<div class="flex-1">
<p class="text-[10px] text-blue-300 uppercase">Tổng quan</p>
<h2 id="title" class="text-2xl font-black"></h2>
</div>

<div class="flex gap-6">

<div>
<div id="total" class="text-3xl font-black">0</div>
<div class="text-[10px] text-slate-400">Tổng</div>
</div>

<div>
<div id="processing" class="text-3xl font-black text-yellow-400">0</div>
<div class="text-[10px] text-slate-400">Đang xử lý</div>
</div>

<div>
<div id="overdue" class="text-3xl font-black text-red-500">0</div>
<div class="text-[10px] text-slate-400">Quá hạn</div>
</div>

<div>
<div id="done" class="text-3xl font-black text-green-400">0</div>
<div class="text-[10px] text-slate-400">Hoàn thành</div>
</div>

</div>
</div>

<div class="flex-1 bg-blue-600 flex items-center px-8 text-white">
<div id="subLabel" class="text-xl font-bold">Tất cả</div>
</div>

</header>

<!-- SUBMENU -->
<div id="sub" class="submenu bg-white border-b flex items-center px-8 gap-2 overflow-x-auto"></div>

<!-- SEARCH -->
<div class="bg-white px-8 py-2 border-b">
<input id="search" placeholder="Tìm nhiệm vụ..." class="border rounded px-3 py-1 text-sm w-72">
</div>

<!-- TABLE -->
<main class="content p-4">
<div class="bg-white h-full shadow rounded overflow-hidden flex flex-col">

<div class="flex-1 overflow-auto">
<table class="w-full text-left">

<thead class="bg-slate-100 text-xs">
<tr>
<th class="p-3 w-14 text-center">STT</th>
<th class="p-3">Nhiệm vụ</th>
<th class="p-3 w-40 text-center">Đơn vị</th>
<th class="p-3 w-32 text-center cursor-pointer" onclick="sortByDate()">Hạn ↓</th>
<th class="p-3 w-64 text-center">Tiến độ</th>
</tr>
</thead>

<tbody id="body"></tbody>
</table>
</div>

<div id="empty" class="hidden text-center p-20 text-slate-300">
Không có dữ liệu
</div>

</div>
</main>
</div>

<script>
const menus={
"Sở":["Văn phòng","P.CĐS","P.KH","P.TĐC","P.CN&ĐMST"],
"UBND":["Kịch bản","Đề án","CTLV"],
"NQ57":["Hạ tầng","Nhân lực","Ngân sách"],
"Tỉnh ủy":["NQ11","CTHD33","CTLV25"],
"Big":["AI","Carbon","Halal"]
}

const progress=[
"Chưa làm",
"CV đang xử lý",
"Lãnh đạo phòng kiểm tra",
"PGĐ đang kiểm tra",
"Giám đốc duyệt",
"Đã hoàn thành",
"Lấy ý kiến",
"VP UBND",
"VP Tỉnh ủy"
]

let data=[]
let main=""
let sub="TẤT CẢ"
let uploaded=false

function clean(t){
return String(t||"").replace(/</g,"&lt;").replace(/>/g,"&gt;")
}

function parseDate(v){
if(!v)return null
if(typeof v==="number"){
let d=new Date(1899,11,30)
return new Date(d.getTime()+v*86400000)
}
if(v.includes("/")){
let[a,b,c]=v.split("/")
return new Date(`${c}-${b}-${a}`)
}
return new Date(v)
}

function status(row){
if(row["Tiến độ"]==="Đã hoàn thành")return"done"
let d=parseDate(row["Hạn"])
if(d && d<new Date())return"overdue"
return"processing"
}

function renderMenu(){
menu.innerHTML=Object.keys(menus).map(k=>
`<button onclick="selectMain('${k}')" class="block w-full p-3 text-left hover:bg-blue-600 rounded">${k}</button>`
).join("")
}

function selectMain(k){
main=k
title.innerText=k
renderSub()
if(!uploaded && !data.length)mock()
selectSub("TẤT CẢ")
}

function renderSub(){
sub.innerHTML=["TẤT CẢ",...menus[main]]
.map(s=>`<button onclick="selectSub('${s}')" class="px-4 py-2 border rounded text-xs">${s}</button>`).join("")
}

function selectSub(s){
sub=s
subLabel.innerText=s
render()
}

function mock(){
data=[]
menus[main].forEach(m=>{
for(let i=1;i<=3;i++){
data.push({
id:crypto.randomUUID(),
"Nội dung":`Task ${i} ${m}`,
"Đơn vị":m,
"Hạn":"30/03/2026",
"Tiến độ":progress[0]
})
}})
}

function render(){

let keyword=search.value.toLowerCase()

let list=data.filter(t=>{
let ok=sub==="TẤT CẢ"||t["Đơn vị"]===sub
let match=t["Nội dung"].toLowerCase().includes(keyword)
return ok && match
})

if(!list.length){
body.innerHTML=""
empty.classList.remove("hidden")
return
}
empty.classList.add("hidden")

body.innerHTML=list.map((t,i)=>{
let s=status(t)

return`
<tr class="border-t hover:bg-slate-50">
<td class="p-3 text-center">${i+1}</td>
<td class="p-3">${clean(t["Nội dung"])}</td>
<td class="p-3 text-center">${clean(t["Đơn vị"])}</td>
<td class="p-3 text-center">${t["Hạn"]}</td>
<td class="p-3">
<select onchange="update('${t.id}',this.value)" class="border p-1 text-xs">
${progress.map(p=>`<option ${p==t["Tiến độ"]?"selected":""}>${p}</option>`).join("")}
</select>
<span class="status ml-2 ${s=="done"?"bg-green-100 text-green-700":s=="overdue"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}">
${s=="done"?"Hoàn thành":s=="overdue"?"Quá hạn":"Đang xử lý"}
</span>
</td>
</tr>`
}).join("")

stats()
}

function stats(){
total.innerText=data.length
done.innerText=data.filter(t=>status(t)=="done").length
overdue.innerText=data.filter(t=>status(t)=="overdue").length
processing.innerText=data.filter(t=>status(t)=="processing").length
}

function update(id,val){
let t=data.find(x=>x.id==id)
if(t){t["Tiến độ"]=val;render()}
}

function sortByDate(){
data.sort((a,b)=>{
let da=parseDate(a["Hạn"])||0
let db=parseDate(b["Hạn"])||0
return da-db
})
render()
}

search.oninput=render

file.onchange=e=>{
let f=e.target.files[0]
if(!f)return
uploaded=true

let r=new FileReader()
r.onload=x=>{
let wb=XLSX.read(x.target.result,{type:"array"})
let raw=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]])

data=raw.map(r=>{
let k=Object.keys(r)
let f=t=>k.find(x=>t.some(a=>x.toLowerCase().includes(a)))

return{
id:crypto.randomUUID(),
"Nội dung":r[f(["nội dung","task","công việc","tên"])]||"",
"Đơn vị":r[f(["đơn vị","phòng","cơ quan"])]||"",
"Hạn":r[f(["hạn","ngày","date"])]||"",
"Tiến độ":r[f(["tiến độ","trạng thái"])]||progress[0]
}
})

render()
}
r.readAsArrayBuffer(f)
}

renderMenu()
selectMain("Sở")
</script>

</body>
</html>
